<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christmas Runner</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: 'Arial', sans-serif;
            background: linear-gradient(to bottom, #1a0033, #4d001f, #00172d);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            position: relative;
            touch-action: none;
        }

        canvas {
            background: linear-gradient(to bottom, #87ceeb, #ffffff);
            border: 8px solid #228b22;
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
            max-width: 95vw;
            max-height: 80vh;
            width: 800px;
            height: 400px;
        }

        @media (max-width: 850px) {
            canvas {
                border: 4px solid #228b22;
                border-radius: 10px;
                width: 95vw;
                height: calc(95vw * 0.5);
            }

            #score {
                font-size: 20px;
                padding: 6px 12px;
                top: 10px;
            }

            #startOverlay,
            #gameOverOverlay {
                font-size: 1.2rem;
            }

            #restartBtn {
                font-size: 1rem !important;
                padding: 8px 16px !important;
            }
        }

        @media (max-width: 500px) {
            canvas {
                width: 98vw;
                height: calc(98vw * 0.5);
            }

            #score {
                font-size: 18px;
                padding: 5px 10px;
                top: 5px;
            }
        }

        #score {
            position: absolute;
            top: 20px;
            font-size: 32px;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8), 0 0 10px rgba(255, 215, 0, 0.5);
            background: rgba(0, 0, 0, 0.3);
            padding: 10px 20px;
            border-radius: 15px;
        }

        #startOverlay,
        #gameOverOverlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 2rem;
            text-align: center;
            cursor: pointer;
            z-index: 20;
            flex-direction: column;
        }

        .snowflake {
            position: fixed;
            top: -10px;
            color: white;
            font-size: 1em;
            opacity: 0.8;
            pointer-events: none;
            user-select: none;
            z-index: 5;
            animation-name: fall;
            animation-timing-function: linear;
        }

        @keyframes fall {
            to {
                transform: translateY(110vh) rotate(360deg);
                opacity: 0.5;
            }
        }
    </style>
</head>

<body>

    <div id="score">üéÅ 0</div>
    <div id="startOverlay">üéÑ Tap to Start üéÑ</div>
    <div id="gameOverOverlay" style="display:none;">
        <div>üéÖ Game Over üéÖ</div>
        <button id="restartBtn"
            style="margin-top:20px; font-size:1.2rem; padding:10px 20px; cursor:pointer;">Restart</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <script>
        // -------- Snow Effect --------
        function createSnow() {
            const flake = document.createElement("div");
            flake.classList.add("snowflake");
            flake.innerHTML = "‚ùÑ";

            flake.style.left = Math.random() * window.innerWidth + "px";
            flake.style.fontSize = (Math.random() * 15 + 10) + "px";
            flake.style.animationDuration = (Math.random() * 3 + 2) + "s";

            document.body.appendChild(flake);
            setTimeout(() => flake.remove(), 5000);
        }
        setInterval(createSnow, 100);

        // -------- Game Setup --------
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size responsively
        function resizeCanvas() {
            const maxWidth = 800;
            const maxHeight = 400;
            const aspectRatio = maxWidth / maxHeight;

            let width = Math.min(maxWidth, window.innerWidth * 0.95);
            let height = width / aspectRatio;

            if (height > window.innerHeight * 0.8) {
                height = window.innerHeight * 0.8;
                width = height * aspectRatio;
            }

            canvas.width = maxWidth;
            canvas.height = maxHeight;
            canvas.style.width = width + 'px';
            canvas.style.height = height + 'px';
        }

        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);

        const gameWidth = canvas.width;
        const gameHeight = canvas.height;

        let player = { x: 50, y: gameHeight - 60, width: 50, height: 50, dy: 0, gravity: 0.8, jumpPower: -16, onGround: true };
        let obstacles = [];
        let obstacleTimer = 0;
        let obstacleInterval = 80;
        let score = 0;
        let frameCounter = 0;
        let gameStarted = false;
        let gameOver = false;
        let gameSpeed = 6;
        let clouds = [];
        let gifts = [];
        let giftTimer = 0;

        // Jump
        function jump() {
            if (gameStarted && !gameOver && player.onGround) {
                player.dy = player.jumpPower;
                player.onGround = false;
            }
        }

        // Controls
        document.addEventListener('keydown', e => { if (e.code === 'Space') jump(); });
        canvas.addEventListener('click', jump, { passive: true });
        canvas.addEventListener('touchstart', (e) => {
            e.preventDefault();
            jump();
        }, { passive: false });

        // Start Game
        const startOverlay = document.getElementById('startOverlay');
        startOverlay.addEventListener('click', () => {
            gameStarted = true;
            startOverlay.style.display = 'none';
        });

        // Game Over Overlay
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const restartBtn = document.getElementById('restartBtn');
        restartBtn.addEventListener('click', () => {
            // Reset game
            player.y = gameHeight - 60;
            player.dy = 0;
            obstacles = [];
            obstacleTimer = 0;
            score = 0;
            frameCounter = 0;
            gameOver = false;
            gameSpeed = 6;
            gifts = [];
            giftTimer = 0;
            obstacleInterval = 80;
            gameOverOverlay.style.display = 'none';
        });

        // -------- Game Loop --------
        // Initialize clouds
        for (let i = 0; i < 5; i++) {
            clouds.push({
                x: Math.random() * gameWidth,
                y: Math.random() * 100 + 20,
                width: Math.random() * 60 + 40,
                speed: Math.random() * 0.5 + 0.3
            });
        }

        function drawSanta(x, y, width, height) {
            // Body (red suit)
            ctx.fillStyle = '#DC143C';
            ctx.fillRect(x, y + height * 0.4, width, height * 0.6);

            // Head
            ctx.fillStyle = '#FFD9B3';
            ctx.beginPath();
            ctx.arc(x + width / 2, y + height * 0.25, width * 0.35, 0, Math.PI * 2);
            ctx.fill();

            // Hat
            ctx.fillStyle = '#DC143C';
            ctx.beginPath();
            ctx.moveTo(x + width * 0.15, y + height * 0.25);
            ctx.lineTo(x + width * 0.85, y + height * 0.25);
            ctx.lineTo(x + width * 0.5, y);
            ctx.fill();

            // Hat trim
            ctx.fillStyle = 'white';
            ctx.fillRect(x + width * 0.15, y + height * 0.22, width * 0.7, height * 0.08);

            // Belt
            ctx.fillStyle = '#2F2F2F';
            ctx.fillRect(x, y + height * 0.65, width, height * 0.12);

            // Buckle
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(x + width * 0.35, y + height * 0.66, width * 0.3, height * 0.1);
        }

        function drawTree(x, y, width, height) {
            // Trunk
            ctx.fillStyle = '#8B4513';
            ctx.fillRect(x + width * 0.35, y + height * 0.7, width * 0.3, height * 0.3);

            // Tree layers
            ctx.fillStyle = '#228B22';
            for (let i = 0; i < 3; i++) {
                ctx.beginPath();
                ctx.moveTo(x + width * 0.5, y + i * height * 0.25);
                ctx.lineTo(x, y + (i + 1) * height * 0.3);
                ctx.lineTo(x + width, y + (i + 1) * height * 0.3);
                ctx.closePath();
                ctx.fill();
            }

            // Ornaments
            ctx.fillStyle = '#FF0000';
            ctx.beginPath();
            ctx.arc(x + width * 0.3, y + height * 0.4, 3, 0, Math.PI * 2);
            ctx.fill();
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(x + width * 0.7, y + height * 0.5, 3, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawGift(x, y, size) {
            // Box
            ctx.fillStyle = '#FF6B6B';
            ctx.fillRect(x, y, size, size);

            // Ribbon
            ctx.fillStyle = '#FFD700';
            ctx.fillRect(x + size * 0.4, y, size * 0.2, size);
            ctx.fillRect(x, y + size * 0.4, size, size * 0.2);

            // Bow
            ctx.beginPath();
            ctx.arc(x + size * 0.5, y + size * 0.5, size * 0.15, 0, Math.PI * 2);
            ctx.fill();
        }

        function drawCloud(x, y, width) {
            ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
            ctx.beginPath();
            ctx.arc(x, y, width * 0.3, 0, Math.PI * 2);
            ctx.arc(x + width * 0.3, y - width * 0.1, width * 0.25, 0, Math.PI * 2);
            ctx.arc(x + width * 0.6, y, width * 0.3, 0, Math.PI * 2);
            ctx.fill();
        }

        function update() {
            ctx.clearRect(0, 0, gameWidth, gameHeight);

            // Sky gradient
            const gradient = ctx.createLinearGradient(0, 0, 0, gameHeight);
            gradient.addColorStop(0, '#87CEEB');
            gradient.addColorStop(1, '#E0F6FF');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, gameWidth, gameHeight);

            // Draw and move clouds
            clouds.forEach(cloud => {
                drawCloud(cloud.x, cloud.y, cloud.width);
                cloud.x -= cloud.speed;
                if (cloud.x + cloud.width < 0) {
                    cloud.x = gameWidth;
                    cloud.y = Math.random() * 100 + 20;
                }
            });

            // Ground
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, gameHeight - 10, gameWidth, 10);

            if (gameStarted && !gameOver) {
                // Increase difficulty
                if (score > 0 && score % 100 === 0 && gameSpeed < 10) {
                    gameSpeed += 0.1;
                }

                // Player physics
                player.dy += player.gravity;
                player.y += player.dy;
                if (player.y >= gameHeight - player.height) {
                    player.y = gameHeight - player.height;
                    player.dy = 0;
                    player.onGround = true;
                }

                // Draw player as Santa
                drawSanta(player.x, player.y, player.width, player.height);

                // Spawn obstacles
                obstacleTimer++;
                if (obstacleTimer > obstacleInterval) {
                    obstacles.push({ x: gameWidth, y: gameHeight - 50, width: 50, height: 50, type: 'tree' });
                    obstacleTimer = 0;
                    obstacleInterval = Math.max(50, 80 - Math.floor(score / 50));
                }

                // Spawn gifts
                giftTimer++;
                if (giftTimer > 150) {
                    gifts.push({ x: gameWidth, y: gameHeight - 80 - Math.random() * 100, size: 30, collected: false });
                    giftTimer = 0;
                }

                // Update and draw gifts
                gifts.forEach((gift, i) => {
                    gift.x -= gameSpeed * 0.8;
                    drawGift(gift.x, gift.y, gift.size);

                    // Collect gifts
                    if (!gift.collected &&
                        player.x < gift.x + gift.size &&
                        player.x + player.width > gift.x &&
                        player.y < gift.y + gift.size &&
                        player.y + player.height > gift.y
                    ) {
                        gift.collected = true;
                        score += 10;
                    }
                });
                gifts = gifts.filter(g => g.x + g.size > 0);

                // Update and draw obstacles
                obstacles.forEach((obs, i) => {
                    obs.x -= gameSpeed;
                    drawTree(obs.x, obs.y, obs.width, obs.height);

                    // Collision detection
                    if (
                        player.x < obs.x + obs.width - 10 &&
                        player.x + player.width - 10 > obs.x &&
                        player.y < obs.y + obs.height - 10 &&
                        player.y + player.height > obs.y
                    ) {
                        gameOver = true;
                        gameOverOverlay.style.display = 'flex';
                    }
                });

                obstacles = obstacles.filter(obs => obs.x + obs.width > 0);

                // Score
                frameCounter++;
                if (frameCounter % 5 === 0) score++;
                document.getElementById('score').innerText = 'üéÅ ' + score;

            } else {
                // Draw player waiting
                drawSanta(player.x, player.y, player.width, player.height);
            }

            requestAnimationFrame(update);
        }

        update();
    </script>
</body>

</html>